services:
  app:
    build:
      context: .
      args:
        BUILD_ZK: 0
    ports:
      - "3000:3000"
    # Pass BUILD_ZK=1 (override) to enable full Rust zk build (slow).
    # Load developer secrets (not committed) from local file.
    # Create a copy of .env.example named .env.local before running.
    env_file:
      - .env.local
    environment:
      - NEXT_PUBLIC_IPFS_API_URL=http://ipfs:5001
      - NEXT_PUBLIC_IPFS_GATEWAY=http://localhost:8080/ipfs
      # Add internal gateway for server-side verification (app container cannot use localhost:8080 for IPFS)
      - IPFS_GATEWAYS=http://ipfs:8080/ipfs,https://ipfs.io/ipfs,https://cloudflare-ipfs.com/ipfs
      - RISC0_DEV_MODE=1
    depends_on:
      - ipfs
    deploy:
      resources:
        limits:
          cpus: "6"
          memory: 12g

  ipfs:
    image: ipfs/kubo:latest
    ports:
      - "4001:4001" # IPFS swarm port
      - "5001:5001" # IPFS API port
      - "8080:8080" # IPFS gateway port
    volumes:
      - ipfs_data:/data/ipfs
    environment:
      - IPFS_PROFILE=server

volumes:
  ipfs_data:

networks:
  ai-proof-network:
    driver: bridge
